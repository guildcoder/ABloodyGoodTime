<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Listen - A Bloody Good Time</title>
<link rel="stylesheet" href="style.css">
<style>
  html, body {
    margin: 0;
    height: 100%;
    overflow: hidden; /* Lock the page scroll */
    font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: #040404;
    color: #eee;
  }

  header {
    position: sticky;
    top: 0;
    background: #040404;
    z-index: 20;
    display: flex;
    justify-content: center;
    padding: 10px 0;
    font-size: 18px;
  }

  header span {
    margin: 0 6px;
    cursor: pointer;
    user-select: none;
  }

  #cassette-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    overflow-y: scroll; /* Only cassette container scrolls */
    display: flex;
    flex-direction: column;
    align-items: center;
    padding-top: 20px;
    box-sizing: border-box;
  }

  .cassette {
    position: relative;
    margin-bottom: -200px; /* overlap effect */
    width: 250px;
    transition: transform 0.3s ease, z-index 0.3s ease;
  }

  .cassette img {
    width: 100%;
    display: block;
    border-radius: 10px;
  }

  .cassette-title {
    position: absolute;
    top: 80px; /* reduced from 150px */
    width: 100%;
    text-align: center;
    font-weight: bold;
    font-size: 16px;
    pointer-events: none;
    padding: 0 20px;
  }

  .pulled-out {
    transform: translateY(-50px) scale(1.05);
    z-index: 5;
  }

  @media(min-width: 768px){
    .cassette { width: 300px; }
    .cassette-title { font-size: 18px; top: 80px; }
  }
</style>
</head>
<body>

<header id="alphabet-bar"></header>

<div id="cassette-container"></div>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script>
google.charts.load('current', {'packages':['corechart']});
google.charts.setOnLoadCallback(drawCassettes);

const sheetURL = 'https://docs.google.com/spreadsheets/d/1YhKiPh70p96zndU2cvtgEhvClq2a3n-MWy0QGpWS3Pw/gviz/tq?sheet=Podcast&headers=1';
const images = ['assets/8track.png','assets/8track-red.png','assets/8track-charcoal.png'];
const colors = ['black', 'red', 'white'];

function drawCassettes() {
  const query = new google.visualization.Query(sheetURL);
  query.send(handleQueryResponse);
}

function handleQueryResponse(response) {
  if (response.isError()) {
    console.error('Error fetching data: ' + response.getMessage());
    return;
  }

  const data = response.getDataTable();
  const container = document.getElementById('cassette-container');
const colors = ['black', 'red', 'white'];

for (let i = 0; i < data.getNumberOfRows(); i++) {
    const title = data.getValue(i, 0);
    const spotifyLink = data.getValue(i, 2);

    const cassetteDiv = document.createElement('div');
    cassetteDiv.classList.add('cassette');
    cassetteDiv.dataset.spotify = spotifyLink;
    cassetteDiv.dataset.title = title;

    const img = document.createElement('img');
    img.src = images[i % images.length]; // rotate images
    cassetteDiv.appendChild(img);

    const titleDiv = document.createElement('div');
    titleDiv.classList.add('cassette-title');
    titleDiv.textContent = title;

    // Assign a consistent color per cassette using index
    titleDiv.style.color = colors[i % colors.length];

    cassetteDiv.appendChild(titleDiv);

    cassetteDiv.addEventListener('click', () => {
      window.open(spotifyLink, '_blank');
    });

    container.appendChild(cassetteDiv);
  }

  updatePulledOut();
}

// Pull-out all cassettes sequentially as you scroll
function updatePulledOut() {
  const cassettes = document.querySelectorAll('.cassette');
  const scrollTop = document.getElementById('cassette-container').scrollTop;

  cassettes.forEach(c => c.classList.remove('pulled-out'));

  for (let i = 0; i < cassettes.length; i++) {
    const topOffset = cassettes[i].offsetTop;
    if (scrollTop + window.innerHeight/2 >= topOffset) {
      cassettes[i].classList.add('pulled-out');
    }
  }
}

document.getElementById('cassette-container').addEventListener('scroll', updatePulledOut);

// Alphabet bar
const alphabetBar = document.getElementById('alphabet-bar');
const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
letters.forEach(letter => {
  const span = document.createElement('span');
  span.textContent = letter;
  span.addEventListener('click', () => {
    const cassettes = document.querySelectorAll('.cassette');
    for (let c of cassettes) {
      if (c.dataset.title.charAt(0).toUpperCase() === letter) {
        document.getElementById('cassette-container').scrollTo({ top: c.offsetTop - 50, behavior: 'smooth' });
        break;
      }
    }
  });
  alphabetBar.appendChild(span);
});
</script>

</body>
</html>